# the definition of composed selections. Can contain as well TCut style selections, e.g.:
# resolved = baseline, btagMM, massCut
# resolvedHighPt = baseline, btagMM, massCut, dau1_pt > 150
# use comma separated lists
[selections]

### some selections with tes up/down
### note: jets are selected at skim level to have pt > 20
### so I am raising the pt value to 25 just to test the change in the acceptance

jetsVBFloose_nominal = isVBF && VBFjj_mass > 500 && VBFjj_deltaEta > 3
jetsVBFloose_jesUp = isVBF && VBFjj_mass_jetup > 500 && VBFjj_deltaEta > 3 && VBFjet2_pt_jetup > 30
jetsVBFloose_jesDown = isVBF && VBFjj_mass_jetdown > 500 && VBFjj_deltaEta > 3 && VBFjet2_pt_jetdown > 30

noVBFloose_nominal = !(isVBF && VBFjj_mass > 500 && VBFjj_deltaEta > 3)
noVBFloose_jesUp = !(isVBF && VBFjj_mass_jetup > 500 && VBFjj_deltaEta > 3 && VBFjet2_pt_jetup > 30)
noVBFloose_jesDown = !(isVBF && VBFjj_mass_jetdown > 500 && VBFjj_deltaEta > 3 && VBFjet2_pt_jetdown > 30)


baseline_nominal     = pairType == 2 && dau1_pt > 40 && abs (dau1_eta) < 2.1 && dau2_pt > 40 && abs (dau2_eta) < 2.1 && nleps == 0 && nbjetscand > 1 && isVBFtrigger == 0 && bjet1_pt > 25 && bjet2_pt > 25

baseline_tesUp_DM0       = pairType == 2 && dau1_pt_tauup_DM0 > 40   && abs (dau1_eta) < 2.1 && dau2_pt_tauup_DM0 > 40   && abs (dau2_eta) < 2.1 && nleps == 0       && bjet1_pt > 25         && bjet2_pt > 25 && isVBFtrigger == 0
baseline_tesDown_DM0     = pairType == 2 && dau1_pt_taudown_DM0 > 40 && abs (dau1_eta) < 2.1 && dau2_pt_taudown_DM0 > 40 && abs (dau2_eta) < 2.1 && nleps == 0       && bjet1_pt > 25         && bjet2_pt > 25 && isVBFtrigger == 0

baseline_jesUp       = pairType == 2 && dau1_pt > 40         && abs (dau1_eta) < 2.1 && dau2_pt > 40         && abs (dau2_eta) < 2.1 && nleps == 0       && bjet1_pt_raw_jetup > 25   && bjet2_pt_raw_jetup > 25 && isVBFtrigger == 0
baseline_jesDown     = pairType == 2 && dau1_pt > 40         && abs (dau1_eta) < 2.1 && dau2_pt > 40         && abs (dau2_eta) < 2.1 && nleps == 0       && bjet1_pt_raw_jetdown > 25 && bjet2_pt_raw_jetdown > 25 && isVBFtrigger == 0

ellypsMassCut_tesUp_DM0    = ((tauH_SVFIT_mass_tauup_DM0-116.)*(tauH_SVFIT_mass_tauup_DM0-116.))/(35.*35.) + ((bH_mass_raw-111.)*(bH_mass_raw-111.))/(45.*45.) <  1.0
ellypsMassCut_tesDown_DM0  = ((tauH_SVFIT_mass_taudown_DM0-116.)*(tauH_SVFIT_mass_taudown_DM0-116.))/(35.*35.) + ((bH_mass_raw-111.)*(bH_mass_raw-111.))/(45.*45.) <  1.0
ellypsMassCut_jesUp    = ((tauH_SVFIT_mass_METup-116.)*(tauH_SVFIT_mass_METup-116.))/(35.*35.) + ((bH_mass_raw_jetup-111.)*(bH_mass_raw_jetup-111.))/(45.*45.) <  1.0
ellypsMassCut_jesDown  = ((tauH_SVFIT_mass_METdown-116.)*(tauH_SVFIT_mass_METdown-116.))/(35.*35.) + ((bH_mass_raw_jetdown-111.)*(bH_mass_raw_jetdown-111.))/(45.*45.) <  1.0

s1b1jresolvedMcut_nominal = baseline_nominal , btagM, isBoosted != 1 ,  ellypsMassCut, noVBFloose_nominal
s2b0jresolvedMcut_nominal = baseline_nominal , btagMM, isBoosted != 1 , ellypsMassCut, noVBFloose_nominal
sboostedLLMcut_nominal    = baseline_nominal , btagLL, isBoosted == 1 , ellypsMassCut, noVBFloose_nominal #CHIA ellypsMassCut-> boostMassCut
VBFloose_nominal          = baseline_nominal , jetsVBFloose_nominal, tauH_SVFIT_mass > 50


s1b1jresolvedMcut_tesUp_DM0   = baseline_tesUp_DM0 , btagM,  isBoosted != 1 , ellypsMassCut_tesUp_DM0, noVBFloose_nominal
s2b0jresolvedMcut_tesUp_DM0   = baseline_tesUp_DM0 , btagMM, isBoosted != 1 , ellypsMassCut_tesUp_DM0, noVBFloose_nominal
sboostedLLMcut_tesUp_DM0      = baseline_tesUp_DM0 , btagLL, isBoosted == 1 , ellypsMassCut_tesUp_DM0, noVBFloose_nominal #CHIA ellypsMassCut-> boostMassCut 
VBFloose_tesUp_DM0            = baseline_tesUp_DM0 , jetsVBFloose_nominal, tauH_SVFIT_mass_tauup_DM0 > 50

s1b1jresolvedMcut_tesDown_DM0 = baseline_tesDown_DM0 , btagM,  isBoosted != 1 , ellypsMassCut_tesDown_DM0, noVBFloose_nominal
s2b0jresolvedMcut_tesDown_DM0 = baseline_tesDown_DM0 , btagMM, isBoosted != 1 , ellypsMassCut_tesDown_DM0, noVBFloose_nominal
sboostedLLMcut_tesDown_DM0    = baseline_tesDown_DM0 , btagLL, isBoosted == 1 , ellypsMassCut_tesDown_DM0, noVBFloose_nominal  #CHIA ellypsMassCut-> boostMassCut
VBFloose_tesDown_DM0          = baseline_tesDown_DM0 , jetsVBFloose_nominal, tauH_SVFIT_mass_taudown_DM0 > 50

s1b1jresolvedMcut_jesUp   = baseline_jesUp, btagM, isBoosted != 1 , ellypsMassCut_jesUp, noVBFloose_jesUp
s2b0jresolvedMcut_jesUp   = baseline_jesUp, btagMM, isBoosted != 1 , ellypsMassCut_jesUp , noVBFloose_jesUp
sboostedLLMcut_jesUp      = baseline_jesUp, btagLL, isBoosted == 1 , boostMassCut, noVBFloose_jesUp
VBFloose_jesUp            = baseline_jesUp, jetsVBFloose_jesUp, tauH_SVFIT_mass_METup > 50

s1b1jresolvedMcut_jesDown = baseline_jesDown , btagM, isBoosted != 1 , ellypsMassCut_jesDown, noVBFloose_jesDown
s2b0jresolvedMcut_jesDown = baseline_jesDown , btagMM, isBoosted != 1 , ellypsMassCut_jesDown, noVBFloose_jesDown
sboostedLLMcut_jesDown    = baseline_jesDown , btagLL, isBoosted == 1 , boostMassCut, noVBFloose_jesDown
VBFloose_jesDown          = baseline_jesDown, jetsVBFloose_jesDown, tauH_SVFIT_mass_METdown > 50


# btag requirements - DeepFlavor WPs={0.0494, 0.2770, 0.7264}; // L,M,T -- Legacy 2018 DeepFlavor
btagL        = bjet1_bID_deepFlavor > 0.0494 && bjet2_bID_deepFlavor < 0.0494 #only 1 jet with loose btag working point
btagM        = bjet1_bID_deepFlavor > 0.2770 && bjet2_bID_deepFlavor < 0.2770 #only 1 jet with medium btag working point
btagMfirst   = bjet1_bID_deepFlavor > 0.2770                                  #at least 1 jet with medium btag working point
btagLL       = bjet1_bID_deepFlavor > 0.0494 && bjet2_bID_deepFlavor > 0.0494 #both jets with loose btag working point
btagMM       = bjet1_bID_deepFlavor > 0.2770 && bjet2_bID_deepFlavor > 0.2770 #both jets with medium btag working point
nobtagMM     = bjet1_bID_deepFlavor < 0.2770 && bjet2_bID_deepFlavor < 0.2770 #both jets NOT btagged (medium working point)



boostMassCut = tauH_SVFIT_mass > 79.5 && tauH_SVFIT_mass < 152.5 && fatjet_softdropMass > 90 && fatjet_softdropMass < 160 
ellypsMassCut  = ((tauH_SVFIT_mass-116.)*(tauH_SVFIT_mass-116.))/(35.*35.) + ((bH_mass_raw-111.)*(bH_mass_raw-111.))/(45.*45.) <  1.0 # mass cut centered on the Hbb Htt masses, applied in the final selections 

SR           = isOS != 0 && dau1_deepTauVsJet >= 5 && dau2_deepTauVsJet >= 5                   # signal region: opposite sign, isolated taus


#########################################################################
#########################################################################

## weights to be applied for a certain selections when calling Fill()
## multiple weights are passed as list and are multiplied together
## NOTE: no weight is applied for data (the simple Fill() is used)
[selectionWeights]
#baseline         = MC_weight, PUReweight, PUjetID_SF, trigSF, FakeRateSF_deep, DYscale_MTT
baseline          = MC_weight, PUReweight, PUjetID_SF, trigSF, IdAndIsoAndFakeSF_deep, DYscale_MTT

# remove DY weights, they are already taken into account in baseline weights
btagLL         = bTagweightL
btagMM         = bTagweightM
nobtagMM       = bTagweightM
btagL          = bTagweightL
btagM         = bTagweightM


[selectionWeights_ext] # beta feature! use with care!
#weights decay mode dependent computed with QCD backgrond estimation, DY LO weights, old DY weights, on top of decay mode dependend trigger weights, m_vis > 55 #11 Mar 2019 #used for testing, already saved in the skims

# tauIDSF 8May2020
#baseline = (dau1_decayMode == 0 && isTau1real ): 1.182, (dau2_decayMode == 0 && isTau2real ): 1.182, (dau1_decayMode == 1 && isTau1real): 1.146, (dau2_decayMode == 1 && isTau2real ): 1.146, (dau1_decayMode == 10 && isTau1real ): 1.149, (dau2_decayMode == 10 && isTau2real ): 1.149, (dau1_decayMode == 11 && isTau1real ): 0.811, (dau2_decayMode == 11 && isTau2real ): 0.811


#########################################################################
#########################################################################

[sampleWeights]
TTfullyHad = TTtopPtreweight #, IdAndIsoSF
TTfullyLep = TTtopPtreweight #, IdAndIsoSF
TTsemiLep  = TTtopPtreweight #, IdAndIsoSF

#########################################################################
#########################################################################

# define alternative weights to be tested instead of the nominal one
[systematics]
TTtopPtreweight  = topUp:TTtopPtreweight_up , topDown:TTtopPtreweight_down
# trigSF         = trigUP:trigSF_up , trigDOWN:trigSF_down
# turnOnreweight = rewUP:turnOnreweight_tauup, rewDO:turnOnreweight_taudown

#########################################################################
#########################################################################

# ROOT-like definition of the binning
[histos]
DNNoutSM_kl_1            = 35,0,1


#########################################################################
#########################################################################

# user defined binning for a variable - has precedence on [histos]
[binning]

#########################################################################
#########################################################################

[histos2D]

[binning2D]


